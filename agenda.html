<html>
<head>
	<meta charset="UTF-8">
	<script type="text/javascript" src="./dependencies/jquery-3.2.1.min.js"></script>
	<script type="text/javascript" src="./dependencies/jquery-ui.min.js"></script>
	<script type="text/javascript" src="./dependencies/bootstrap.min.js"></script>
	<link rel='stylesheet' href='./dependencies/jquery-ui.min.css' />
	<link rel='stylesheet' href='./dependencies/fullcalendar.css' />
	<script src='./dependencies/moment.min.js'></script>
	<script src='./dependencies/fullcalendar.js'></script>
	<link rel="stylesheet" href="./dependencies/bootstrap.min.css">
	
	<link rel="stylesheet" href="weboss.css">
	<title>WeBoss Agenda</title>
</head>
<body>
	<div class="row">
		<div class="col-xs-12 col-md-12 ">
			<a href="./menu.html"><h2 class="title">WeBoss</h2></a>
		</div>

		<container class="col-xs-12 col-md-8 col-md-offset-2">
			<div class="form-inline">
				<input type="text" class="form-control" name="event" id="event" placeholder="Adresse"/>
				<input type="text" class="form-control" id="datepicker" placeholder="Date"/>
				<input type="text" class="form-control" id="time" placeholder="Heure"/>
				<button class="btn btn-primary" id="add">Ajouter</button>
			</div>
			<div id='calendar'></div>
		</container>
	</div>
</body>
</html>

<script>	
$(document).ready(function() {
	var location = null;
	var autocomplete = null;

    // page is now ready, initialize the calendar...

    $('#datepicker').datepicker();

    $('#calendar').fullCalendar({
		defaultView: 'basicWeek',
		editable: true
    })

    updateCalendar();

    /*var event={id:1 , title: 'Julien', start:  new Date()};

	$('#calendar').fullCalendar('renderEvent', event, true);*/

	$('#add').click(function(){
		var date = $('#datepicker').datepicker('getDate');
		date.setHours($('#time').val().split(':')[0]);
		date.setMinutes($('#time').val().split(':')[1]);
		
		var event={id:Date.now() ,title: $('#event').val(), start: date, location: location};

		var events = JSON.parse(localStorage.getItem('events'));
		if (events == null){
			events = [];
		}
		events.push(event);
		localStorage.setItem('events', JSON.stringify(events));

		updateCalendar();
	});

	autocomplete = new google.maps.places.Autocomplete(
            /** @type {!HTMLInputElement} */(document.getElementById('event')),
            {types: ['geocode']});

    // When the user selects an address from the dropdown, populate the address
    // fields in the form.
    autocomplete.addListener('place_changed', function(){
		var place = autocomplete.getPlace();
		location = place.geometry.location;
    });
});

function updateCalendar(){
	$('#calendar').fullCalendar('removeEvents');

	var events = JSON.parse(localStorage.getItem('events'));
	events.forEach(function(event){
		$('#calendar').fullCalendar('renderEvent', event, true);
	})
}
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCCbTdWN0Pe_ji5cWugNvDblRlregC_MSE&libraries=places"></script>